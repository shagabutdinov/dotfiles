export PATH=$PATH:/home/leo/.composer/vendor/bin:/usr/lib/jvm/java-8-openjdk/bin/:/home/leo/.gem/ruby/2.3.0/bin:/home/leo/src/go/bin

export BROWSER=firefox
export APPLICATION_ENV=development

export PROMPT="%{$bg[blue]%}%{$fg[white]%}%2~ å†¬%{$reset_color%} "
export GOPATH=~/src/go

export TERM='rxvt-unicode'
export COLORTERM='rxvt-unicode-256color'

autoload -U select-word-style
select-word-style bash

bindkey "\e\e[D" backward-word
bindkey "\e\e[C" forward-word

autoload -U promptinit
promptinit

zle -N prepend-sudo prepend_sudo
function prepend_sudo() {
        if [ "$BUFFER" ]; then
                BUFFER="sudo "$BUFFER
        else
                BUFFER="sudo "$(fc -ln -1)
        fi
        CURSOR=$(($CURSOR+5))
}

bindkey "^T" prepend-sudo

alias sc="sudo systemctl"
alias scs="sudo systemctl start"
alias scr="sudo systemctl restart"
alias sct="sudo systemctl stop"
alias subl="subl3 -n -w"
alias yaourt="yaourt --noconfirm"
alias shaitan="sudo systemctl"
alias uo="nohup xdg-open"
o() {
  nohup xdg-open "$@" &
  disown
}
alias ut="urxvt -cd $(pwd) &"
alias mv=/bin/mv
alias ms="mysql -u root"
alias pwgen="pwgen 12"
alias nc="sudo netctl"
alias pm="sudo pacman"
alias pms="sudo pacman -S"
alias pmr="sudo pacman -R"
alias pmro="sudo pacman -Rns \$(pacman -Qtdq)"
alias pmq="pacman -Ql"
alias steam="wine '/home/leo/.wine/drive_c/Program Files (x86)/Steam/Steam.exe' -no-dwrite"
alias s="subl3"
alias x="xsel -ib"
alias l="ls --color -hl --group-directories-first"
alias ls="ls --color -h --group-directories-first"

alias ril="redmine-issue list"
alias ris="redmine-issue start"
alias ric="redmine-issue complete"
alias rip="redmine-issue pause"
alias rid="redmine-issue description"

alias dfp="balmora dotfiles-submit"
alias dfu="balmora dotfiles-update"

export GREP_OPTIONS=''
export NODE_PATH="~/.node:/usr/lib/node_modules"
export WINEARCH='win32'

alias grep="grep --exclude-dir=.cvs --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --color=auto"
alias tree="tree --dirsfirst"
alias ps="ps -xau"
alias cal="cal -3m"
alias uwhatsapp="chromium --app=https://web.whatsapp.com"

alias goapp="/opt/google-appengine-go/goapp"
alias b="bundle exec"
alias bi="bundle install"

alias wd="nmcli -p dev wifi list"
alias wc="nmcli -p dev wifi connect"
alias wl="nmcli -p con show"
alias ws="nmcli -p con show --active"
alias wu="nmcli -p con up id"

alias d="docker"
alias de="docker exec -i -t"
alias di="docker inspect"
alias dp='docker ps --format "table{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}"'
alias dr="docker run --rm -i -t"
alias dl="docker logs --tail 200"
alias dlf="docker logs --follow"
alias da="docker attach --no-stdin"

alias c="docker-compose -f"
alias cm='docker-compose -f config/local/main.yml'
alias cl='docker-compose -f config/$(ls --color=none config/ | grep --color=none \\.local)/main.yml'
alias ct='docker-compose -f config/$(ls --color=none config/ | grep --color=none \\.local)/test.yml'
# alias cd='docker-compose -f config/$(ls --color=none config/ | grep --color=none \\.dev1\\.idfly\\.ru)/main.yml'

alias co='sudo chown -R leo: '
alias cc='sudo chown -R leo: .'

alias gs="git show --color"
alias gsp="git commit -v -a && git push"
alias gsa="git commit -v -a --amend && git push --force"
alias gpf="git push --force"
alias ge="git rebase"
alias gei="git rebase --interactive"
alias gec="git rebase --continue"
alias gea="git rebase --abort"
alias gpu='git push -u origin $(current_branch)'
alias gdd='git diff --color | diff-so-fancy | less'
alias gdc='git diff --cached'
alias gh='git stash'
alias ghp='git stash pop'
alias gfp='git fetch --prune'
alias gcb='git checkout origin/dev'
alias gcm='git checkout origin/master'
alias gt='git reset'

alias json='python -m "json.tool"'

alias dbe='docker exec -i -t $(docker-backend)'

alias dbea='docker exec -i -t $(
  docker ps --format "table{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}" |
  grep backend |
  grep admin |
  sort -k 2 |
  head -n 1 |
  awk "{ print \$1 }"
)'

alias dfe='docker exec -i -t $(
  docker ps --format "table{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}" |
  sort -k 2 |
  grep frontend |
  grep -v admin |
  head -n 1 |
  awk "{ print \$1 }"
)'

alias dfea='docker exec -i -t $(
  docker ps --format "table{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}" |
  sort -k 2 |
  grep frontend |
  grep admin |
  head -n 1 |
  awk "{ print \$1 }"
)'

alias -g B="bundle exec"
alias -g G="| grep"
alias uskypeweb="chromium -app=https://web.skype.com/en/"
alias isd="issue -S --from origin/dev --id "
alias ism="issue -S --from origin/master --id "

function docker-backend() {
  echo $(
    docker ps --format "table{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}" |
    grep backend |
    grep -v admin |
    sort -k 2 |
    head -n 1 |
    awk "{ print \$1 }"
  )
}

alias rc='docker exec -i -t $(docker-backend) rails console'
alias re='docker exec -i -t $(docker-backend) rails runner'
alias rg='docker exec -i -t $(docker-backend) rails generate'

alias rme='docker exec -i -t $(docker-backend) rake db:migrate'
alias rms='docker exec -i -t $(docker-backend) rake db:migrate:status'
alias rmr='docker exec -i -t $(docker-backend) rake db:migrate:redo'
alias rs='docker exec -i -t $(docker-backend) rake db:seed'
alias rr='docker exec -i -t $(docker-backend) rake db:rollback'

unalias rgm
function rgm {
  MIGRATION=$(
    docker exec -i -t $(docker-backend) rails generate migration $@ |
      grep -o 'db/.*.rb' |
      head -n 1
  )

  docker exec -i -t $(docker-backend) chown 1000:1000 $MIGRATION
  subl3 $MIGRATION
}


umask 002

eval "$(ssh-agent -s)" > /dev/null 2>&1
ssh-add > /dev/null 2>&1
